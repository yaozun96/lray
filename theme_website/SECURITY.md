# V2Board主题授权保护系统

## 功能说明

本主题已集成授权保护系统，防止未经授权的使用和API地址被篡改。

### 保护机制

1. **API域名绑定验证**
   - API地址已加密存储，运行时验证
   - 任何修改API地址的尝试都会被检测并阻止应用启动

2. **授权密钥验证**
   - 应用启动时验证授权密钥
   - 密钥格式和内容必须正确，否则阻止启动

3. **代码混淆和压缩**
   - 使用Terser进行变量名混淆
   - 删除所有console和debugger语句
   - 删除代码注释
   - 大幅增加代码阅读和逆向难度

4. **反调试保护**
   - 禁用右键菜单
   - 禁用F12和开发者工具快捷键
   - DevTools检测（不阻止，仅清空控制台）

## 授权配置

当前授权配置：
- **API域名**: https://api.cwtgo.com/ (加密存储在 `src/utils/auth.js` 中)
- **授权密钥**: 硬编码混淆存储在 `src/utils/auth.js` 中 (不再使用 `public/config.js`)

## 生成新的授权密钥

如果需要更新授权密钥：

```bash
node scripts/generate-key.js
```

将生成的混淆代码复制到 `src/utils/auth.js` 中，替换 `_0x3c8f` 变量定义。

**重要**: 密钥已改为硬编码到源码中，不再存储在公开可访问的 `public/config.js` 文件中，大大提升了安全性。

## 更换API域名

如果需要更换授权的API域名：

1. 运行密钥生成工具获取新域名的加密字符串：
   ```bash
   node scripts/generate-key.js
   ```

2. 将"加密的API域名"复制到 `src/utils/auth.js` 的 `_0x4a2b` 变量

3. 重新构建项目：
   ```bash
   npm run build
   ```

## 构建说明

### 开发模式
```bash
npm run dev
```
开发模式也会进行授权验证。

### 生产构建
```bash
npm run build
```

生产构建会：
- 启用代码混淆和压缩
- 删除所有调试信息
- 合并所有JavaScript到单文件
- 生成优化后的dist目录

## 安全注意事项

1. **授权密钥管理**
   - 密钥已硬编码到源码中，无法通过浏览器直接访问
   - 密钥使用 String.fromCharCode 混淆存储，增加逆向难度
   - 定期更新授权密钥以增强安全性

2. **源码保护**
   - 不要公开 `dist` 目录和源码
   - Git提交时注意排除构建产物
   - 授权密钥存储在 `src/utils/auth.js` 中，需要编译才能访问

3. **前端安全限制**
   - 前端加密可被破解，但大幅增加了破解成本
   - 建议配合后端进行二次验证（如前端指纹）
   - 密钥硬编码方式比配置文件方式安全性高数倍

## 验证失败处理

如果授权验证失败，应用会：
1. 清空控制台
2. 显示"未授权使用"错误页面
3. 阻止应用继续运行
4. 在错误页面显示加密的错误代码

## 文件清单

### 核心文件
- `src/utils/auth.js` - 授权验证模块（包含硬编码的授权密钥和API域名）
- `src/utils/request.js` - HTTP请求拦截器（集成域名验证）
- `src/main.js` - 应用入口（启动时验证）
- `public/config.js` - 配置文件（不再包含授权密钥）
- `vite.config.js` - 构建配置（代码混淆）

### 工具脚本
- `scripts/generate-key.js` - 授权密钥生成工具

## 技术细节

### 加密方式
- API域名：双重Base64编码
- 授权密钥：Base64编码 + 格式验证
- 变量名：混淆命名（_0x4a2b等）

### 混淆配置
- 顶层变量混淆
- Console语句删除
- Debugger语句删除
- 死代码移除
- 注释删除
- 3次压缩优化

## 常见问题

**Q: 如何临时禁用授权验证进行测试？**
A: 开发环境下验证会输出警告但不阻止运行。生产环境严格验证。

**Q: 为什么密钥不存储在 config.js 中？**
A: `public/config.js` 可以通过浏览器直接访问（如 `/config.js`），将密钥存储在源码中需要反编译才能获取，安全性大幅提升。

**Q: 构建后的代码有多大？**
A: 约1.2MB（压缩后380KB gzip）

**Q: 会影响性能吗？**
A: 授权验证仅在启动时执行一次，对运行时性能影响极小。

**Q: 如何验证授权系统是否生效？**
A: 修改 `src/utils/auth.js` 中的授权密钥或API域名，应用会立即阻止启动。

## 授权方式

- **严格模式**：验证失败直接阻止应用启动（当前配置）
- 开发和生产环境均启用验证

## 版本信息

- 授权系统版本: 1.0.0
- 实施日期: 2024-12
- 混淆级别: 基础（Terser）

---

**注意**：此授权系统旨在提高盗用成本，但无法完全防止破解。建议配合后端验证机制使用。
